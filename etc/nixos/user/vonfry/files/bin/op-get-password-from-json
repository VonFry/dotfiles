#!/usr/bin/env ruby

require 'json'

begin
    item = `op get item #{ARGV * " "}`
    op = JSON.parse item
rescue
    abort "JSON parse failed."
end

if op["details"]["fields"]
    username, password =
        op["details"]["fields"].select do |obj|
            obj["designation"].eql? "username"
        end + op["details"]["fields"].select do |obj|
            obj["designation"].eql? "password"
        end
    username = username["value"]
    password = password["value"]
elsif op["details"]["password"]
    username = nil
    password = op["details"]["password"]
end

if password.nil?
    abort "No result."
end

puts <<EOF
uuid:      #{op["uuid"]}
vaultUuid: #{op["vaultUuid"]}
url:       #{op["overview"]["url"]}
title:     #{op["overview"]["title"]}
username:  #{username}
password:  #{password}
EOF

