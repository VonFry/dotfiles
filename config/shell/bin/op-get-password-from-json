#!/usr/bin/env ruby

require 'json'

begin
  item = `op get item #{ARGV * " "}`
  op = JSON.parse(item)
rescue
  abort "JSON parse failed."
end

if op["details"]["fields"]
    username, password =
    op["details"]["fields"].select do |obj|
        obj["designation"].eql? "username"
    end + op["details"]["fields"].select do |obj|
        obj["designation"].eql? "password"
    end
else if op["details"]["password"]
  username = { "value" => nil }
  password = op["details"]["password"]
end

puts <<EOF
uuid:      #{op["uuid"]}
vaultUuid: #{op["vaultUuid"]}
url:       #{op["overview"]["url"]}
title:     #{op["overview"]["title"]}
username:  #{username["value"]}
password:  #{password["value"]}
EOF
