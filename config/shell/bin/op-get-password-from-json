#!/usr/bin/env ruby

require 'json'

begin
  item = `op get item #{ARGV * " "}`
  op = JSON.parse(item)
rescue
  abort "JSON parse failed."
end

fields  =
  op["details"]["fields"].filter do |obj|
    ! (obj["designation"] =~ /^(username|password)$/).nil?
  end
username  = fields.select do |obj|
  obj["designation"].eql? "username"
end
password  = fields.select do |obj|
  obj["designation"].eql? "password"
end

puts <<EOF
uuid:      #{op["uuid"]}
vaultUuid: #{op["vaultUuid"]}
url:       #{op["overview"]["url"]}
title:     #{op["overview"]["title"]}
username:  #{username["value"]}
password:  #{password["value"]}
EOF
